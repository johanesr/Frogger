<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Week 1</title>
  <script type="text/javascript" src="babylon.custom.js">
  </script>
  <script type="text/javascript" src="material.js">
  </script>
  <script type="text/javascript" src="animations.js">
  </script>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <canvas id="renderCanvas"></canvas>
  <script>

  var canvas, engine, scene, camera;
  var jump = false;
  document.addEventListener("DOMContentLoaded", function()
  {
    canvas = document.getElementById("renderCanvas");

    engine = new BABYLON.Engine(canvas, true);

    scene = new BABYLON.Scene(engine);
    gravity = new BABYLON.Vector3(0,-9.81,0);
    physicsEngine = new BABYLON.CannonJSPlugin();
    scene.enablePhysics(gravity, physicsEngine);

    var camera = new BABYLON.FollowCamera("Camera", new BABYLON.Vector3(0, 4.5 ,10), scene);
    camera.radius = 25;
    camera.heightOffSet = 0;
    //camera.rotationOffset = 90;
    camera.cameraAcceleration = 0.5;
    camera.attachControl(canvas, true);

    ground = new BABYLON.Mesh.CreateGround("ground", 100000, 100000, 1,scene);

    ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground,
    BABYLON.PhysicsImpostor.BoxImpostor, {mass:0, restitution: 0.2, friction: 0.2},scene);

    var bb = new BABYLON.SceneLoader.ImportMesh("", "bb-unit-babylon/", "bb-unit.babylon", scene, function (newMeshes) {
      bb8 = newMeshes[0];
      bb8.scaling = new BABYLON.Vector3(0.02, 0.02, 0.02);
      camera.lockedTarget = bb8;
      //bb8.position.y=1.2;
      bb8.position = new BABYLON.Vector3(0, 1.15, 10 );
      //bb8.addRotation(0,Math.PI/4,0);
      console.log(bb8.position);
      bb8forward = function ()
      {
        forward(bb8,scene,bb8.position,function(){ jump = false});
        console.log(bb8.position);
      }
      bb8back = function ()
      {
        back(bb8,scene,bb8.position,function(){ jump = false});
      }
      // bb8.physicsImpostor = new BABYLON.PhysicsImpostor(bb8,
      // BABYLON.PhysicsImpostor.BoxImpostor,{mass:1, restitution: 0.5, friction: 0.2},scene);
    });

    var enemy = new BABYLON.SceneLoader.ImportMesh("", "stormtrooper-babylon/", "stormtrooper.babylon", scene, function (newMeshes) {
      monster = newMeshes[0];
      monster.scaling = new BABYLON.Vector3(1.5, 1.5, 1.5);
      // monster.position = new BABYLON.Vector3(0, 0, 0);
    });

    var light = new BABYLON.HemisphericLight("hLight",
    new BABYLON.Vector3(0, 8, 0), scene);

    var mat = createMat(scene);

    var box = new BABYLON.Mesh.CreateBox("box", 1.0, scene);
    box.position = new BABYLON.Vector3(0, 0.5, 10 );
    box.isVisible = false;

    // box.physicsImpostor = new BABYLON.PhysicsImpostor(box,
    // BABYLON.PhysicsImpostor.BoxImpostor,{mass:1, restitution: 1, friction: 0.2},scene);

    var box2 = new BABYLON.Mesh.CreateBox("box2", 1.0, scene);
    box2.position = new BABYLON.Vector3(60, 0.5, -2);
    box2.physicsImpostor = new BABYLON.PhysicsImpostor(box2,
    BABYLON.PhysicsImpostor.BoxImpostor,{mass:1, restitution: 0.5, friction: 0.2},scene);
    box2.isVisible=false;

    var mat2 = createMat(scene);

    box.material = mat;
    box2.material = mat2;

    var clones = [];

    //scene.render();
    var test;
    window.onkeydown = function(event)
    {
      if(event.keyCode==87 && jump==false)
      {
        jump = true;
        bb8forward();
        var clone = box2.createInstance("box2"+1);
        clones.push(clone);
      }
      if(event.keyCode==83 && jump==false)
      {
        jump = true;
        bb8back();
      }
    }

    engine.runRenderLoop(function()
    {
      // box.physicsImpostor.applyImpulse(new BABYLON.Vector3(-0.5,0,0),
      // box.getAbsolutePosition());
      for(var i = 0; i<clones.length;i++)
      {
        clones[i].position.x = clones[i].position.x - 0.25;
      }
      //console.log(jump);
      scene.render();
    });
  });


</script>
</body>
</html>
